<!DOCTYPE html>
<html>
<head>
  <title>Barang Scanner & Pencarian</title>
  <meta charset="UTF-8" />
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
  <style>
    body { font-family: Arial; padding: 20px; background: #f9f9f9; }
    input, button { padding: 10px; margin: 10px 0; width: 100%; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    #reader { margin-top: 20px; }
  </style>
</head>
<body>
  <h2>Scan Barcode / Cari Barang</h2>
  <input type="text" id="searchInput" placeholder="Scan atau ketik ID/Nama Produk..." />
  <button onclick="search()">Cari</button>

  <div id="reader" style="width:300px;"></div>

  <table id="dataTable">
    <thead>
      <tr><th>ID</th><th>Produk</th><th>Harga Jual</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <script src="https://unpkg.com/html5-qrcode"></script>
  <script>
    let dataList = [];

    const CSV_URL = "https://docs.google.com/spreadsheets/d/1UgT68VSYfc0dDUpaeyNzVqAIxGTi2txJ9neBhr1qy2w/gviz/tq?tqx=out:csv&sheet=Barang";

    async function loadData() {
      const res = await fetch(CSV_URL);
      const text = await res.text();
      const rows = text.trim().split("\n").map(r => r.split(","));
      const headers = rows.shift(); // Buang baris header

      dataList = rows.map(r => ({
        ID: r[1],
        Produk: r[2],
        Harga: r[3]
      }));

      showTable(dataList);
    }

    function showTable(data) {
      const tbody = document.querySelector("#dataTable tbody");
      tbody.innerHTML = "";
      data.forEach(item => {
        const row = `<tr><td>${item.ID}</td><td>${item.Produk}</td><td>${item.Harga}</td></tr>`;
        tbody.innerHTML += row;
      });
    }

    function search() {
      const query = document.getElementById("searchInput").value.trim();
      if (!query) {
        showTable(dataList);
        return;
      }

      const fuse = new Fuse(dataList, {
        keys: ["ID", "Produk"],
        threshold: 0.4,
      });

      const results = fuse.search(query).map(r => r.item);
      showTable(results);
    }

    // Barcode scanner
    function onScanSuccess(decodedText, decodedResult) {
      document.getElementById("searchInput").value = decodedText;
      search();
    }

    new Html5QrcodeScanner("reader", { fps: 10, qrbox: 250 }).render(onScanSuccess);

    window.onload = loadData;
  </script>
</body>
</html>
